<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Sentiment Analysis - Food Bot</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root { --gold-color: #c59d5f; --dark-blue: #0a192f; }

body {
    font-family: 'Inter', sans-serif;
    background-color: #f8f9fa;
    color: #333;
    margin: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}
.font-playfair { font-family: 'Playfair Display', serif; }

header {
    background-color: rgba(255,255,255,0.9);
    backdrop-filter: blur(6px);
    padding: 1rem;
    text-align: center;
    font-size: 1.75rem;
    font-weight: bold;
    position: sticky;
    top: 0;
    z-index: 50;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

footer {
    background-color: #1f2937;
    color: #fff;
    text-align: center;
    padding: 2rem 1rem;
}

textarea {
    width: 100%;
    padding: 1rem;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    resize: none;
    font-size: 1rem;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}
textarea:focus {
    outline: none;
    border-color: var(--gold-color);
    box-shadow: 0 0 10px rgba(197,157,95,0.4);
}

button {
    cursor: pointer;
    border: none;
    border-radius: 12px;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
}
#analyze-btn { background-color: var(--gold-color); color: white; }
#analyze-btn:hover { transform: translateY(-3px) scale(1.03); box-shadow: 0 6px 20px rgba(197,157,95,0.4); }

#clear-btn { background-color: #e5e7eb; color: #374151; }
#clear-btn:hover { background-color: #d1d5db; }

#text_to_speech { background-color: #22c55e; color: white; }
#text_to_speech:hover { background-color: #16a34a; }

#sentiment-result-container {
    background-color: #f3f4f6;
    border-radius: 16px;
    padding: 2rem;
    min-height: 380px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

#sentiment-result { width: 100%; text-align: center; }

.emoji { font-size: 4rem; margin-bottom: 0.5rem; }
.positive .emoji { animation: bounce 1s infinite; }
.negative .emoji { animation: shake 0.5s infinite; }
.neutral .emoji { animation: pulse 1.5s infinite; }
@keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
@keyframes shake { 0%,100% { transform: translateX(0); } 25% { transform: translateX(-3px); } 75% { transform: translateX(3px); } }
@keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.05); } }

.keyword-tag { padding: 6px 12px; border-radius: 8px; font-size: 0.875rem; margin: 2px; display: inline-block; }
.keyword-positive { background-color: #dcfce7; color: #166534; }
.keyword-negative { background-color: #fee2e2; color: #991b1b; }

.progress-circle { position: relative; width: 120px; height: 120px; margin: 1rem auto; }
.progress-circle-bg, .progress-circle-fg { fill: none; stroke-width: 10; }
.progress-circle-bg { stroke: #e6e6e6; }
.progress-circle-fg {
    stroke: var(--gold-color);
    stroke-linecap: round;
    transform: rotate(-90deg);
    transform-origin: 50% 50%;
    transition: stroke-dashoffset 0.8s ease-out, stroke 0.8s ease-out;
}
.progress-circle-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5rem; font-weight: bold; color: #333; }

.loader {
    border: 4px solid #f3f3f3;
    border-top: 4px solid var(--gold-color);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 1rem auto;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</head>
<body>
<header>food bot</header>

<main class="flex-grow py-12">
<section class="container mx-auto px-6">
<div class="text-center mb-12">
    <h1 class="text-4xl md:text-5xl font-playfair font-bold mb-4">Advanced Feedback Analysis</h1>
    <p class="max-w-2xl mx-auto text-gray-600">AI detects sentiment, emotions, and keywords from your review in a clear and understandable way.</p>
</div>

<div class="max-w-4xl mx-auto grid md:grid-cols-2 gap-8 items-start bg-white p-8 rounded-xl shadow-2xl">
<div>
    <h2 class="text-2xl font-playfair font-bold mb-4">Leave Your Review</h2>
    <textarea id="feedback-text" rows="8" placeholder="Enter your feedback here..."></textarea>
    <div class="flex space-x-4 mt-4">
        <button id="analyze-btn">Analyze Feedback</button>
        <button id="clear-btn">Clear</button>
        <button id="text_to_speech" type="button">text to speech</button>
    </div>
</div>

<div id="sentiment-result-container">
    <div id="sentiment-result-placeholder" class="text-gray-500 pt-16">
        <p>Your analysis will appear here.</p>
    </div>
    <div id="sentiment-result" class="hidden">
        <div class="emoji" id="sentiment-emoji">üòê</div>
        <h3 class="text-xl font-bold mb-2" id="sentiment-label">Neutral</h3>
        <p id="sentiment-explanation" class="text-gray-700 mb-4">This indicates a neutral sentiment in your feedback.</p>
        <div class="progress-circle">
            <svg viewBox="0 0 100 100">
                <circle class="progress-circle-bg" cx="50" cy="50" r="45"></circle>
                <circle class="progress-circle-fg" id="progress-bar" cx="50" cy="50" r="45"></circle>
            </svg>
            <div class="progress-circle-text" id="average-score-text">0.00</div>
        </div>
        <div id="detected-emotion" class="mt-4 mb-2 text-lg"></div>
        <div id="detected-keywords" class="flex flex-wrap justify-center mt-2"></div>
    </div>
</div>
</div>
</section>
</main>


<script>
const analyzeBtn = document.getElementById('analyze-btn');
const clearBtn = document.getElementById('clear-btn');
const nextPageBtn = document.getElementById('text_to_speech'); // Reusing text_to_speech as next page
const feedbackText = document.getElementById('feedback-text');
const sentimentResult = document.getElementById('sentiment-result');
const sentimentPlaceholder = document.getElementById('sentiment-result-placeholder');
const sentimentEmoji = document.getElementById('sentiment-emoji');
const sentimentLabel = document.getElementById('sentiment-label');
const sentimentExplanation = document.getElementById('sentiment-explanation');
const detectedEmotion = document.getElementById('detected-emotion');
const detectedKeywords = document.getElementById('detected-keywords');
const progressBar = document.getElementById('progress-bar');
const averageScoreText = document.getElementById('average-score-text');

const radius = progressBar.r.baseVal.value;
const circumference = 2 * Math.PI * radius;
progressBar.style.strokeDasharray = `${circumference} ${circumference}`;
progressBar.style.strokeDashoffset = circumference;

analyzeBtn.addEventListener('click', async () => {
    const text = feedbackText.value.trim();
    if(!text) return alert("Please enter feedback.");

    sentimentPlaceholder.classList.add('hidden');
    sentimentResult.classList.remove('hidden');
    sentimentEmoji.textContent = '‚è≥';
    sentimentLabel.textContent = 'Analyzing...';
    sentimentExplanation.textContent = 'Processing your feedback...';
    detectedEmotion.textContent = '';
    detectedKeywords.innerHTML = '';

    const apiKey = 'NgGRmo1L0XWS1bDWWpfUcxgwtwmemXofPuWVCU3Vxbhc';
    const url = 'https://api.au-syd.natural-language-understanding.watson.cloud.ibm.com/instances/1cc1816c-2b56-4dcd-b578-00025cbd3447/v1/analyze?version=2021-08-01';

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type':'application/json',
                'Authorization':'Basic '+btoa('apikey:'+apiKey)
            },
            body: JSON.stringify({
                text,
                features: { sentiment:{}, keywords:{}, emotion:{} }
            })
        });
        const data = await response.json();

        const sentiment = data.sentiment.document.label;
        const score = data.sentiment.document.score.toFixed(2);
        let emoji='üòê', label='Neutral', explanation='Neutral sentiment indicates balanced feedback.', className='neutral';
        if(sentiment==='positive'){emoji='üòä'; label='Positive'; explanation='This feedback shows a positive sentiment.'; className='positive';}
        if(sentiment==='negative'){emoji='üòû'; label='Negative'; explanation='This feedback shows a negative sentiment.'; className='negative';}
        sentimentEmoji.textContent = emoji;
        sentimentLabel.textContent = label;
        sentimentExplanation.textContent = explanation;
        sentimentResult.className = className;

        if(data.emotion?.document){
            const emotions = data.emotion.document.emotion;
            const maxEmotion = Object.keys(emotions).reduce((a,b)=>emotions[a]>emotions[b]?a:b);
            detectedEmotion.textContent = `Detected Emotion: ${maxEmotion.charAt(0).toUpperCase()+maxEmotion.slice(1)} (${(emotions[maxEmotion]*100).toFixed(0)}%)`;
        }

        detectedKeywords.innerHTML = '';
        if(data.keywords && data.keywords.length > 0){
            data.keywords.forEach(k => {
                const span = document.createElement('span');
                span.className = 'keyword-tag ' + (k.relevance > 0.5 ? 'keyword-positive' : 'keyword-negative');
                span.textContent = k.text;
                detectedKeywords.appendChild(span);
            });
        } else {
            detectedKeywords.textContent = 'No keywords detected.';
        }

        const normalizedScore = (parseFloat(score)+1)/2;
        const offset = circumference - normalizedScore*circumference;
        progressBar.style.strokeDashoffset = offset;
        averageScoreText.textContent = score;
    } catch(e){
        console.error(e);
        alert("Error analyzing feedback. Please try again.");
        sentimentEmoji.textContent = '‚ö†Ô∏è';
        sentimentLabel.textContent = 'Error';
        sentimentExplanation.textContent = 'Unable to process the feedback at this moment.';
    }
});

// Next Page
text_to_speech.addEventListener('click', () => {
    window.location.href = 'text_to_speech.html';
});

// Clear
clearBtn.addEventListener('click', ()=> {
    feedbackText.value = '';
    sentimentResult.classList.add('hidden');
    sentimentPlaceholder.classList.remove('hidden');
    detectedKeywords.innerHTML = '';
    detectedEmotion.textContent = '';
    progressBar.style.strokeDashoffset = circumference;
    averageScoreText.textContent = '0.00';
    sentimentResult.className = '';
});
</script>
</body>
</html>

